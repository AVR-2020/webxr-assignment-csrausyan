<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>billiard</title>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
    
</head>
<body>
    <script>
        AFRAME.registerComponent("pushableobject", {
            init:function() {
                let el = this.el;
                el.addEventListener("collide", function(ev) {
                    console.log("%c" + ev.srcElement.id, "font-size:2em");
                });
                el.addEventListener("click", function() {
                    let positionObject = el.getAttribute("position");
                    let positionVector = new THREE.Vector3(positionObject.x, positionObject.y, positionObject.z);
                    
                    let camPosObject = document.querySelector("#rig").getAttribute("position");
                    let camPosVector = new THREE.Vector3(camPosObject.x, camPosObject.y, camPosObject.z);
                    
                    // Besaran direction dipengaruhi oleh jarak kamera ke object
                    let direction = camPosVector.sub(positionVector);
                    direction = direction.normalize();  // Jadi vektor unit
                    let speed = -10;
                    direction = direction.multiplyScalar(speed);
                    // Fungsi di bawah ini ada di Cannon.js
                    el.body.applyImpulse(
                        new CANNON.Vec3(direction.x, 0, direction.z),  // ke arah z- (menjauh dari kamera)
                        new CANNON.Vec3().copy(positionVector)
                    );
                });
            }
        });
        AFRAME.registerComponent('modify-materials', {
            init: function () {
            // Wait for model to load.
            this.el.addEventListener('model-loaded', () => {
                // Grab the mesh / scene.
                const obj = this.el.getObject3D('mesh');
                // Go over the submeshes and modify materials we want.
                obj.traverse(node => {
                if (node.name.indexOf('ship') !== -1) {
                    node.material.color.set('red');
                }
                });
            });
            }
        });
    </script>

    <a-scene id="scene" physics="debug: true; friction: 4; iteration: 69; restitution: 0.9" stats>
        <!-- <a-camera 
            id="cam"
            position="0 2 -5"
            rotation="180 0 0"
        >
            <a-cursor></a-cursor>
        </a-camera> -->
        <a-entity
            id="rig"
            position="0 2 5"
            rotation="0 180 0"
            look-controls
            wasd-controls="
                acceleration: 300;"
        >
            <a-entity
                id="cam"
                camera="active: true"
                
            >
                <a-cursor></a-cursor>
            </a-entity>
        </a-entity>
        
        <!-- billiard ball -->
        <a-sphere  
            pushableobject 
            dynamic-body="
            mass: 10; angularDamping: 0.3; linearDamping: 0.3
            "
            radius="0.2"
            color="white" 
            shadow 
            position="0 1.5 3"
            wireframe="false"
        >
        </a-sphere>

        <!-- billiard table -->
        <a-box 
            position="0 1 0" 
            static-body
            rotation="0 0 0"
            scale="4 0.05 8"
            color="green"
            material="opacity: 1.0; transparent: false"></a-box>
            >
        </a-box>
        
        <!-- billiard barrier -->
        <a-box 
            position="0 1.2 -4.2" 
            static-body
            rotation="0 0 0"
            scale="3.25 0.05 0.5"
            color="red"
            material="opacity: 1.0; transparent: false"></a-box>
            >
        </a-box>
        <a-box 
            position="0 1.2 4.2" 
            static-body
            rotation="0 0 0"
            scale="3.25 0.05 0.5"
            color="red"
            material="opacity: 1.0; transparent: false"></a-box>
            >
        </a-box>
        
        <a-box 
            position="-2.25 1.2 1.85" 
            static-body
            rotation="0 0 0"
            scale="0.5 0.05 2.9"
            color="red"
            material="opacity: 1.0; transparent: false"></a-box>
            >
        </a-box>
        <a-box 
            position="2.25 1.2 1.85" 
            static-body
            rotation="0 0 0"
            scale="0.5 0.05 2.9"
            color="red"
            material="opacity: 1.0; transparent: false"></a-box>
            >
        </a-box>

        <a-box 
            position="-2.25 1.2 -1.85" 
            static-body
            rotation="0 0 0"
            scale="0.5 0.05 2.9"
            color="red"
            material="opacity: 1.0; transparent: false"></a-box>
            >
        </a-box>
        <a-box 
            position="2.25 1.2 -1.85" 
            static-body
            rotation="0 0 0"
            scale="0.5 0.05 2.9"
            color="red"
            material="opacity: 1.0; transparent: false"></a-box>
            >
        </a-box>
        <!-- <a-assets>
            <a-asset-item id="cityModel" src="assets/billiard1.gltf"></a-asset-item>
        </a-assets>
        <a-entity gltf-model="#cityModel"
            modify-materials  
            static-body>
        </a-entity> -->
        
        <!-- <a-gltf-model 
            src="billiard1.gltf" 
            shadow="receive: true"
            static-body
            wireframe="true"
            modify-materials
            >
        </a-gltf-model> -->
        
        <!-- <a-assets>
            <a-asset-item id="billiard-obj" src="assets/billiard1.obj"></a-asset-item>
            <a-asset-item id="billiard-mtl" src="assets/billiard1.mtl"></a-asset-item>
        </a-assets>
        <a-entity 
            obj-model="obj: #billiard-obj; mtl: #billiard-mtl"
            modify-materials
            wireframe="true"
            static-object
            friction="0"
            >
        </a-entity> -->
        
    </a-scene>
</body>
</html>