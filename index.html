<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>billiard-game</title>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
    
</head>
<body>
    <script>
        AFRAME.registerComponent("pushableobject", {
            init:function() {
                let el = this.el;
                el.addEventListener("click", function() {
                    let positionObject = el.getAttribute("position");
                    let positionVector = new THREE.Vector3(positionObject.x, positionObject.y, positionObject.z);
                    
                    let camPosObject = document.querySelector("#rig").getAttribute("position");
                    let camPosVector = new THREE.Vector3(camPosObject.x, camPosObject.y, camPosObject.z);
                    
                    // Besaran direction dipengaruhi oleh jarak kamera ke object
                    let direction = camPosVector.sub(positionVector);
                    direction = direction.normalize();  // Jadi vektor unit
                    let speed = -30;
                    direction = direction.multiplyScalar(speed);
                    // Fungsi di bawah ini ada di Cannon.js
                    el.body.applyImpulse(
                        new CANNON.Vec3(direction.x, 0, direction.z),  // ke arah z- (menjauh dari kamera)
                        new CANNON.Vec3().copy(positionVector)
                    );
                });
            }
        });
        
        AFRAME.registerComponent("touchobject", {
            init:function() {
                let el = this.el;
                el.addEventListener("collide", function(ev) {
                    // console.log("%c" + ev.srcElement.id, "font-size:1em");
                });
            }
        });

        AFRAME.registerComponent("autospawn", {
            update:function() {
                var el = this.el;
                el.addEventListener("collide", function(ev) {
                    // console.log("%c" + ev.srcElement.id, "font-size:1em");
                    el.object3D.position.set(0, 0, 0);
                    // el.setAttribute('position',{x: 0, y: 0, z: 0});
                    let positionObject = el.getAttribute("position");
                    console.log(el);
                    console.log(positionObject);
                    // let positionVector = new THREE.Vector3(positionObject.x, positionObject.y, positionObject.z);
                }); 
            }
        });

        // AFRAME.registerComponent('modify-materials', {
        //     init: function () {
        //     // Wait for model to load.
        //     this.el.addEventListener('model-loaded', () => {
        //         // Grab the mesh / scene.
        //         const obj = this.el.getObject3D('mesh');
        //         // Go over the submeshes and modify materials we want.
        //         obj.traverse(node => {
        //         if (node.name.indexOf('ship') !== -1) {
        //             node.material.color.set('red');
        //         }
        //         });
        //     });
        //     }
        // });
    </script>

    <a-scene id="scene" physics="debug: true; friction: 0.1; iteration: 10; restitution: 0.1; gravity: -10;" stats>
        <!-- <a-camera 
            id="cam"
            position="0 2 -5"
            rotation="180 0 0"
        >
            <a-cursor></a-cursor>
        </a-camera> -->
        <a-assets>
            <a-mixin
                id="table-edge1"
                touchobject
                static-body
                scale="3.25 0.05 0.5"
                material="opacity: 1.0; color: #A52A2A; transparent: false"
            ></a-mixin>
            <a-mixin
                id="table-edge2"
                touchobject
                static-body
                scale="0.5 0.05 2.9"
                material="opacity: 1.0; color: #A52A2A; transparent: false" 
            ></a-mixin>
            <a-mixin
                id="billiard-ball"
                touchobject
                material="src: assets/epic.png; opacity: 1.0; color: #A52A2A; transparent: false"
                dynamic-body="
                mass: 10; angularDamping: 0.3; linearDamping: 0.5; shape: sphere; 
                "
                shadow 
            ></a-mixin>
            <!-- src: assets/epic.png;  -->
        </a-assets>
        <a-entity
            id="rig"
            position="0 2 5"
            rotation="0 180 0"
            look-controls
            wasd-controls="
                acceleration: 300;"
        >
            <a-entity
                id="cam"
                camera="active: true"
                
            >
                <a-cursor></a-cursor>
            </a-entity>
        </a-entity>
        
        <!-- billiard table -->
        <a-box
            id="table"
            touchobject
            position="0 1 0" 
            static-body
            scale="4 0.05 8"
            color="green"
            material="opacity: 1.0; transparent: false"></a-box>
            >
        </a-box>
        
        <!-- billiard barrier -->
        <a-box
            id="edge-1"
            position="0 1.2 -4.2"
            mixin="table-edge1"></a-box>
            >
        </a-box>
        <a-box
            id="edge-2"
            position="0 1.2 4.2"
            mixin="table-edge1"></a-box>
            >
        </a-box>
        
        <a-box
            id="edge-3"
            position="-2.25 1.2 1.85"
            mixin="table-edge2"></a-box>
            >
        </a-box>
        <a-box 
            id="edge-4"
            position="2.25 1.2 1.85"
            mixin="table-edge2"></a-box>
            >
        </a-box>

        <a-box 
            id="edge-5"
            position="-2.25 1.2 -1.85"
            mixin="table-edge2""></a-box>
            >
        </a-box>
        <a-box 
            id="edge-6"
            position="2.25 1.2 -1.85"
            mixin="table-edge2"></a-box>
            >
        </a-box>
        
        <!-- billiard ball -->
        <a-sphere
            id="white-ball"
            pushableobject autospawn
            mixin="billiard-ball"
            radius="0.2"
            color="white"       
            position="0 1.5 3"
            wireframe="false"
        ></a-sphere>

        <a-sphere
            id="1"
            mixin="billiard-ball"
            radius="0.2"
            color="yellow" 
            position="0 1.5 -1"
            wireframe="false"
        ></a-sphere>
        <a-sphere
            id="2"
            mixin="billiard-ball"
            radius="0.2"
            color="blue " 
            position="-0.26 1.5 -1.36"
            wireframe="false"
        ></a-sphere>
        <a-sphere
            id="3"
            mixin="billiard-ball"
            radius="0.2"
            color="red" 
            position="0.26 1.5 -1.36"
            wireframe="false"
        ></a-sphere>
        <a-sphere
            id="4"
            mixin="billiard-ball"
            radius="0.2"
            color="purple" 
            position="-0.475 1.5 -1.75"
            wireframe="false"
        ></a-sphere>
        <a-sphere
            id="5"
            mixin="billiard-ball"
            radius="0.2"
            color="orange" 
            position="0 1.5 -1.75"
            wireframe="false"
        ></a-sphere>
        <a-sphere
            id="6"
            mixin="billiard-ball"
            radius="0.2"
            color="green" 
            position="0.475 1.5 -1.75"
            wireframe="false"
        ></a-sphere>
        <a-sphere
            id="7"
            mixin="billiard-ball"
            radius="0.2"
            color="red" 
            position="-0.7 1.5 -2.13"
            wireframe="false"
        ></a-sphere>
        <a-sphere
            id="8"
            mixin="billiard-ball"
            radius="0.2"
            color="black" 
            position="-0.260 1.5 -2.13"
            wireframe="false"
        ></a-sphere>
        <a-sphere
            id="9"
            mixin="billiard-ball"
            radius="0.2"
            color="yellow" 
            position="0.260 1.5 -2.13"
            wireframe="false"
        ></a-sphere>
        <a-sphere
            id="10"
            mixin="billiard-ball"
            radius="0.2"
            color="blue" 
            position="0.7 1.5 -2.13"
            wireframe="false"
        ></a-sphere>
        <a-sphere
            id="11"
            mixin="billiard-ball"
            radius="0.2"
            color="red" 
            position="-0.925 1.5 -2.5"
            wireframe="false"
        ></a-sphere>
        <a-sphere
            id="12"
            mixin="billiard-ball"
            radius="0.2"
            color="purple" 
            position="-0.475 1.5 -2.5"
            wireframe="false"
        ></a-sphere>
        <a-sphere
            id="13"
            mixin="billiard-ball"
            radius="0.2"
            color="orange" 
            position="0 1.5 -2.5"
            wireframe="false"
        ></a-sphere>
        <a-sphere
            id="14"
            mixin="billiard-ball"
            radius="0.2"
            color="green" 
            position="0.475 1.5 -2.5"
            wireframe="false"
        ></a-sphere>
        <a-sphere
            id="15"
            mixin="billiard-ball"
            radius="0.2"
            color="red" 
            position="0.925 1.5 -2.5"
            wireframe="false"
        ></a-sphere>

        <!-- <a-assets>
            <a-asset-item id="cityModel" src="assets/billiard1.gltf"></a-asset-item>
        </a-assets>
        <a-entity gltf-model="#cityModel"
            modify-materials  
            static-body>
        </a-entity> -->
        
        <!-- <a-gltf-model 
            src="billiard1.gltf" 
            shadow="receive: true"
            static-body
            wireframe="true"
            modify-materials
            >
        </a-gltf-model> -->
        
        <!-- <a-assets>
            <a-asset-item id="billiard-obj" src="assets/billiard1.obj"></a-asset-item>
            <a-asset-item id="billiard-mtl" src="assets/billiard1.mtl"></a-asset-item>
        </a-assets>
        <a-entity 
            obj-model="obj: #billiard-obj; mtl: #billiard-mtl"
            modify-materials
            wireframe="true"
            static-object
            friction="0"
            >
        </a-entity> -->
        
    </a-scene>
</body>
</html>